<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Site Bilgi Sistemi</title>
<style>
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: #f0f2f5;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}
.container {
  width: 100%;
  max-width: 400px;
  text-align: center;
}
.card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-bottom: 20px;
}
input, textarea, button {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  width: 100%;
  font-size: 16px;
}
button {
  cursor: pointer;
  background: #4caf50;
  color: #fff;
  border: none;
  transition: 0.3s;
}
button:hover {
  background: #45a049;
}
textarea {
  resize: none;
  height: 60px;
}
img.mockup {
  width: 100%;
  border-radius: 10px;
  margin-top: 10px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.1);
}
#arizaList div {
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 10px;
  margin: 10px 0;
}
</style>
</head>
<body>
<div class="container">

  <!-- Kullanıcı Türü Seçimi -->
  <div class="card" id="userTypeCard">
    <h2>Hoşgeldiniz</h2>
    <p>Devam etmek için kullanıcı tipinizi seçin:</p>
    <button onclick="selectUserType('sakin')">Site Sakini</button>
    <button onclick="selectUserType('yonetici')">Site Yöneticisi</button>
    <img class="mockup" src="https://i.ibb.co/6N0rXhz/mockup1.png" alt="Mockup Giriş">
  </div>

  <!-- Kayıt / Giriş Ekranı -->
  <div class="card" id="authCard" style="display:none;">
    <h2 id="authTitle">Giriş / Kayıt</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Şifre">
    <button id="loginBtn">Giriş Yap</button>
    <button id="registerBtn">Kayıt Ol</button>
    <img class="mockup" src="https://i.ibb.co/3S4jR0n/mockup2.png" alt="Mockup Kayıt">
  </div>

  <!-- Mesaj / Arıza Ekranı -->
  <div class="card" id="mainCard" style="display:none;">
    <h2>Mesaj ve Arıza</h2>
    <textarea id="message" placeholder="Mesaj yaz..."></textarea>
    <button id="sendMsgBtn">Gönder</button>
    <input type="file" id="photo">
    <button id="uploadPhotoBtn">Foto Yükle</button>
    <h3>Arıza Bildirimleri</h3>
    <div id="arizaList"><p>Henüz arıza bildirimi yok.</p></div>
    <button id="logoutBtn">Çıkış Yap</button>
    <img class="mockup" src="https://i.ibb.co/Lz2j3qM/mockup3.png" alt="Mockup Mesaj">
  </div>

</div>

<script type="module">
// Firebase SDK
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCSqecAGSBDe-PsA-zP77m-j4a59iTbTXE",
  authDomain: "site-bilgi-ace91.firebaseapp.com",
  projectId: "site-bilgi-ace91",
  storageBucket: "site-bilgi-ace91.appspot.com",
  messagingSenderId: "495243926810",
  appId: "1:495243926810:web:8add0201eaa0fa9999e0a3",
  measurementId: "G-WCBREQDWX1"
};

// Initialize
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

// DOM
const userTypeCard = document.getElementById("userTypeCard");
const authCard = document.getElementById("authCard");
const mainCard = document.getElementById("mainCard");
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const registerBtn = document.getElementById("registerBtn");
const logoutBtn = document.getElementById("logoutBtn");
const sendMsgBtn = document.getElementById("sendMsgBtn");
const messageInput = document.getElementById("message");
const uploadPhotoBtn = document.getElementById("uploadPhotoBtn");
const photoInput = document.getElementById("photo");
const arizaListDiv = document.getElementById("arizaList");

let userType = null;

// Kullanıcı tipi seçimi
function selectUserType(type){
  userType = type;
  userTypeCard.style.display = "none";
  authCard.style.display = "flex";
  document.getElementById("authTitle").innerText = type === 'yonetici' ? "Yönetici Girişi" : "Giriş / Kayıt";
}

// Auth
registerBtn.onclick = () => {
  if(userType !== 'sakin') return alert("Yönetici kullanıcı oluşturamaz");
  const email = emailInput.value;
  const password = passwordInput.value;
  createUserWithEmailAndPassword(auth, email, password)
    .then(()=>alert("Kayıt başarılı ✅"))
    .catch(e=>alert(e.message));
};
loginBtn.onclick = () => {
  const email = emailInput.value;
  const password = passwordInput.value;
  signInWithEmailAndPassword(auth, email, password)
    .then(()=>{
      authCard.style.display = "none";
      mainCard.style.display = "flex";
    })
    .catch(e=>alert(e.message));
};
logoutBtn.onclick = () => {
  signOut(auth).then(()=>{
    authCard.style.display = "flex";
    mainCard.style.display = "none";
  });
};

// Mesaj Gönder
sendMsgBtn.onclick = () => {
  const msg = messageInput.value;
  const user = auth.currentUser;
  if(!msg) return alert("Mesaj boş");
  const msgRef = push(ref(db,"mesajlar"));
  set(msgRef,{
    uid: user.uid,
    message: msg,
    timestamp: Date.now()
  });
  messageInput.value = "";
};

// Foto Upload (ImgBB)
uploadPhotoBtn.onclick = async () => {
  const file = photoInput.files[0];
  const user = auth.currentUser;
  if(!file) return alert("Foto seçmedin");

  const formData = new FormData();
  formData.append("image", file);

  try{
    const response = await fetch("https://api.imgbb.com/1/upload?key=83958758d69f2288d4f2c5bd58b7a149",{
      method:"POST",
      body: formData
    });
    const data = await response.json();
    if(data.success){
      const imageUrl = data.data.url;
      const arizaRef = ref(db,"ariza");
      const newArizaRef = push(arizaRef);
      set(newArizaRef,{
        uid: user.uid,
        photo: imageUrl,
        timestamp: Date.now()
      });
      alert("Foto yüklendi ✅");
    } else alert("Yükleme başarısız");
  } catch(e){ alert("Hata oluştu"); console.error(e); }
};

// Arıza Listesi
const arizaRef = ref(db,"ariza");
onValue(arizaRef,(snapshot)=>{
  const data = snapshot.val();
  arizaListDiv.innerHTML = "";
  if(data){
    Object.keys(data).forEach(key=>{
      const item = data[key];
      const div = document.createElement("div");
      div.innerHTML = `
        <p><strong>Kullanıcı UID:</strong> ${item.uid}</p>
        <p><strong>Zaman:</strong> ${new Date(item.timestamp).toLocaleString()}</p>
        <img src="${item.photo}" style="max-width:200px; display:block; margin-top:5px;" />
      `;
      arizaListDiv.appendChild(div);
    });
  } else arizaListDiv.innerHTML="<p>Henüz arıza bildirimi yok.</p>";
});
</script>
</body>
</html>